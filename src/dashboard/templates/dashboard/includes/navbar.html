<nav class="main-header navbar navbar-expand">
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'dashboard:index' %}" class="nav-link">Главная</a>
        </li>
    </ul>

    <ul class="navbar-nav ms-auto">
        <li class="nav-item me-3">
            <div class="form-check form-switch nav-link theme-switch-wrapper m-0 p-0">
                <input class="form-check-input" type="checkbox" role="switch" id="themeSwitch"
                    aria-label="Сменить тему">
                <label class="form-check-label theme-switch mb-0" for="themeSwitch">
                    <b><span class="slider round" data-text-light="Темная" data-text-dark="Светлая">
                            Тема
                        </span></b>
                </label>
            </div>
        </li>
    </ul>

</nav>

<script>
    (() => {
        const toggleSwitch = document.getElementById('themeSwitch');
        const themeText = document.querySelector('label[for="themeSwitch"] .slider');
        const mainHeader = document.querySelector('.main-header');

        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const currentTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');

        function applyTheme(theme) {
            const isDark = theme === 'dark';

            document.body.classList.toggle('dark-mode', isDark);

            if (mainHeader) {
                mainHeader.classList.toggle('navbar-dark', isDark);
                mainHeader.classList.toggle('navbar-light', !isDark);

                mainHeader.classList.toggle('bg-dark', isDark);
                mainHeader.classList.toggle('bg-white', !isDark);

                mainHeader.classList.toggle('text-white', isDark);
                mainHeader.classList.toggle('text-dark', !isDark);
            }

            if (toggleSwitch) toggleSwitch.checked = isDark;

            if (themeText) {
                themeText.textContent = isDark
                    ? themeText.getAttribute('data-text-dark')
                    : themeText.getAttribute('data-text-light');
            }
        }

        function switchTheme(e) {
            const theme = e.target.checked ? 'dark' : 'light';
            localStorage.setItem('theme', theme);
            applyTheme(theme);
        }

        applyTheme(currentTheme);

        toggleSwitch?.addEventListener('change', switchTheme, false);
    })();
</script>